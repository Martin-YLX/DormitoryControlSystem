# STC 串口控制面板

一个基于 **Python + Tkinter** 的桌面应用，用于通过串口与下位机通信，发送和接收定长帧协议（`AA 55` 开头，总长 6 字节），并提供简单的控制界面与日志显示。

[🔗 macOS版仓库](https://github.com/Martin-YLX/DormitoryControlSystem](https://github.com/Martin-YLX/DormitoryControlSystemForMac )


---

## 📘 项目信息

- **项目名称**: STC 串口控制面板  
- **完成时间**: 2025  
- **课程**: 电子与计算机系统实训（2025 夏季学期）  
- **使用软件**: PyCharm, Keil uVision  

---

## ✨ 功能特性

- **开机动画**：程序启动时显示进度条与班级/组员信息。
- **串口管理**：
  - 自动列出可用串口端口。
  - 选择波特率（支持 9600 ~ 230400）。
  - 一键连接/断开。
- **命令发送**：
  - 内置命令表（门、灯、防忘带系统、护眼模式）。
  - 图形化开关按钮，点击即可下发协议帧。
  - 手动输入 HEX 数据，直接发送。
- **日志系统**：
  - 打印 TX（发送）与 RX（接收）的 HEX 数据。
  - 自动分帧，显示完整 `AA 55` 开头的 6 字节帧。
  - 自动滚动，方便调试。
- **自定义控件**：实现 iOS 风格的滑动开关，带动画效果。

---

## 📝 通信协议

- **帧头**：`AA 55`
- **总长**：6 字节
- **补齐/截断**：不足自动补 `00`，超过则截断。
- **示例**：
  - 开灯命令：`AA 55 02 01 00 00`
  - 关灯命令：`AA 55 02 00 00 00`

所有发送均通过统一的 `build_frame_total6()` 函数构造，保证协议一致性。


---

## 🚀 快速运行

### 1. 环境准备
- Python 3.8+
- 依赖库：
  ```bash
  pip install pyserial
  ```

### 2. 运行程序
```bash
python main.py
```

启动后会先显示开机动画，然后进入主界面。

---

## 🔑 核心代码说明

1. **协议处理**
   - `parse_hex_string()`：解析用户输入的 HEX 字符串。
   - `build_frame_total6()`：强制补齐/截断，保证定长 6 字节。
2. **串口通信**
   - `SerialClient`：封装 `pyserial`，后台线程异步收包。
   - `send_bytes()`：统一发送接口。
3. **接收与分帧**
   - `rx_q`：子线程 → 主线程的队列。
   - `_poll_rx()`：主线程定时取队列，打印日志。
   - `_extract_and_handle_frames()`：查找帧头、去粘包、切完整帧。
4. **命令入口**
   - `CMD_HEX`：语义命令表（如 "LIGHT 1" → "AA 55 02 01"）。
   - `_send_cmd_hex(key)`：统一发送命令的入口。
